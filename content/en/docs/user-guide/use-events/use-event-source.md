---
title: "Use EventSource"
linkTitle: "Use EventSource"
weight: 4510
description: >	
    Learn how to use an EventSource to trigger a synchronous function.
---

This document gives an example of how to use an event source to trigger a synchronous function.

In this example, an EventSource is defined for synchronous invocation to use the event source (a Kafka server) as an input bindings of a function (a Knative service). When the event source generates an event, it will invoke the function and get a synchronous return through the `EventSource.Sink` configuration.

## Prerequisites

- You need to prepare a Knative runtime function as the target function. For more information about how to create a Knative runtime function, see [Your First Function: Go](../../../getting-started/your-first-function/function-go).

  {{% alert title="Note" color="success" %}}

  This document uses `function-sample-serving-qrdx8-ksvc-fwml8` as an example of the name of the target function (Knative service). To obtain the name of your function, run the `kubectl get ksvc` command.

  {{% /alert %}}

- You need to prepare a Kafka server as the event source. For more information, see [Setting up a Kafka in Kubernetes](https://github.com/dapr/quickstarts/tree/master/bindings#setting-up-a-kafka-in-kubernetes).

  {{% alert title="Note" color="success" %}}

  This document uses `dapr-kafka.kafka:9092` as an example of the access address of the Kafka server.

  {{% /alert %}}

## Trigger a Synchronous Function

### Create an EventSource

1. Use the following content to create an EventSource configuration file (for example, `eventsource-sink.yaml`).

   {{% alert title="Note" color="success" %}}

   - The following example defines an event source named `my-eventsource` and mark the events generated by the specified Kafka server as `sample-one`.
   - `EventSource.Sink` references the target function (Knative service). 

   {{% /alert %}}

   ```yaml
   apiVersion: events.openfunction.io/v1alpha1
   kind: EventSource
   metadata:
     name: my-eventsource
   spec:
     kafka:
       sample-one:
         brokers: dapr-kafka.kafka:9092
         topic: sample
         authRequired: false
     sink:
       ref:
         apiVersion: serving.knative.dev/v1
         kind: Service
         name: function-sample-serving-qrdx8-ksvc-fwml8
         namespace: default
   ```

2. Run the following command to apply the configuration file.

   ```shell
   kubectl apply -f eventsource-sink.yaml
   ```

3. Run the following commands to check the results.

   ```shell
   $ kubectl get eventsources.events.openfunction.io
   NAME             EVENTBUS   SINK
   my-eventsource              function-sample-serving-ksvc
   
   $ kubectl get components
   NAME                                          AGE
   eventsource-my-eventsource-kafka-sample-one   3m45s
   eventsource-sink-my-eventsource               3m45s
   
   $ kubectl get deployments.apps
   NAME                                           READY   UP-TO-DATE   AVAILABLE   AGE
   eventsource-my-eventsource-kafka-sample-one    1/1     1            1           4m14s
   ```

   {{% alert title="Note" color="success" %}}

   In this example of triggering a synchronous function, the workflow of the EventSource controller is as follows:

   1. Create an EventSource custom resource named `my-eventsource`.
   2. Create a Dapr component named `eventsource-my-eventsource-kafka-sample-one` for associating the event source.
   3. Create a Dapr component named `eventsource-sink-my-eventsource` for associating the target function.
   4. Create a Deployment named `eventsource-my-eventsource-kafka-sample-one` for processing events.

   {{% /alert %}}

### Create an event producer

1. Use the following content to create an event producer configuration file (for example, `events-producer.yaml`).

   {{% alert title="Note" color="success" %}}

   - This document uses the image `openfunctiondev/events-producer:latest` as an example image, which publishes events to the event source at a rate of one event per 5 seconds.
   - To use this image as an event producer, you need to use an environment variable to set the value of `TARGET_NAME` to the name of the Dapr component for associating the event source, namely `eventsource-my-eventsource-kafka-sample-one`.

   {{% /alert %}}

   ```yaml
   apiVersion: apps/v1
   kind: Deployment
   metadata:
     name: events-producer
     labels:
       app: eventsproducer
   spec:
     replicas: 1
     selector:
       matchLabels:
         app: eventsproducer
     template:
       metadata:
         labels:
           app: eventsproducer
         annotations:
           dapr.io/enabled: "true"
           dapr.io/app-id: "events-producer"
           dapr.io/log-as-json: "true"
       spec:
         containers:
           - name: producer
             image: openfunctiondev/events-producer:latest
             imagePullPolicy: Always
             env:
               - name: TARGET_NAME
                 value: "eventsource-my-eventsource-kafka-sample-one"
   ```

2. Run the following command to apply the configuration file.

   ```shell
   kubectl apply -f events-producer.yaml
   ```

3. Run the following command to check the results in real time.

   ```shell
   $ kubectl get po --watch
   NAME                                                           READY   STATUS              RESTARTS   AGE
   events-producer-86b49654-8stj6                                 0/2     ContainerCreating   0          1s
   eventsource-my-eventsource-kafka-sample-one-789b767c79-45bdf   2/2     Running             0          23m
   events-producer-86b49654-8stj6                                 0/2     ContainerCreating   0          1s
   events-producer-86b49654-8stj6                                 1/2     Running             0          5s
   events-producer-86b49654-8stj6                                 2/2     Running             0          8s
   function-sample-serving-qrdx8-ksvc-fwml8-v100-deployment-8cpxsj   0/2     Pending             0          0s
   function-sample-serving-qrdx8-ksvc-fwml8-v100-deployment-8cpxsj   0/2     Pending             0          0s
   function-sample-serving-qrdx8-ksvc-fwml8-v100-deployment-8cpxsj   0/2     ContainerCreating   0          0s
   function-sample-serving-qrdx8-ksvc-fwml8-v100-deployment-8cpxsj   0/2     ContainerCreating   0          2s
   function-sample-serving-qrdx8-ksvc-fwml8-v100-deployment-8cpxsj   1/2     Running             0          4s
   function-sample-serving-qrdx8-ksvc-fwml8-v100-deployment-8cpxsj   1/2     Running             0          4s
   function-sample-serving-qrdx8-ksvc-fwml8-v100-deployment-8cpxsj   2/2     Running             0          4s
   ```



